{{ $json := dict }}
{{ $json = merge $json (dict "version" "https://jsonfeed.org/version/1") }}
{{ $json = merge $json (dict "title" .Site.Title) }}
{{ $json = merge $json (dict "description" (replace .Site.Params.description "<br>" "")) }}
{{ $json = merge $json (dict "home_page_url" (absURL (printf "/%s/" .Site.Params.website))) }}
{{ $json = merge $json (dict "feed_url" (absURL (printf "/%s/jsonfeed.json" .Site.Params.website))) }}
{{ $json = merge $json (dict "icon"  (absURL "/assets/avatar.svg")) }}
{{ $json = merge $json (dict "favicon" (absURL "/favicon.ico")) }}
{{ $json = merge $json (dict "author" (dict "name" "OKAMURA Naoki" "url" "https://the.kalaclista.com/nyarla/" "avatar" "https://the.kalaclista.com/assets/avatar.svg")) }}
{{ $items := slice }}
{{ if eq .Site.Params.website "home" }}
{{ range $section := slice "posts" "echos" "notes" "bookmarks" }}
{{ $items = append (index $.Site.Data $section).items $items }}
{{ end }}
{{ $json = merge $json (dict "items" (sort $items "date" "desc")) }}
{{ else }}
{{ range $page := first 10 .Site.RegularPages.ByDate.Reverse }}
{{ $meta := partial "meta.html.html" (slice $.Site .Page $.Data) | unmarshal }}
{{ $item := dict }}
{{ $item = merge $item (dict "id" $meta.permalink ) }}
{{ $item = merge $item (dict "url" $meta.permalink ) }}
{{ $item = merge $item (dict "title" $page.Title) }}
{{ $item = merge $item (dict "content_html" (partial "markup.html.html" $page.Content) )}}
{{ $item = merge $item (dict "date" $page.Date) }}
{{ $item = merge $item (dict "tags" $page.Params.tags) }}
{{ $item = merge $item (dict "external_link" $page.Params.link) }}
{{ $items = append (slice $item) $items }}
{{ end }}
{{ $json = merge $json (dict "items" $items) }}
{{ end }}
{{ $json | jsonify }}
