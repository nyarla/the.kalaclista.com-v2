<!doctype html>
<html lang="ja">
  <head prefix="og: http://ogp.me/ns# website: http://ogp.me/ns/website#">
    {{ partial "shared/meta.html.html" . }}
    {{ partial "echos/meta.html.html" . }}
  </head>
  <body>
    {{ partial "shared/header.html.html" . }}

    {{ define "echo" }}
    <article class="echo post">
      <h1><a href="{{ .Permalink }}">{{ .Title }}</a></h1>
      <section class="content">
        {{ partial "functions/markup.html.html" .Content }}
      </section>

      <p class="postedat">
        <a href="https://the.kalaclista.com/nyarla/" class="hexagon">
          <img src="{{ absURL "/assets/avatar.svg"}}" width="24" height="24" alt="nyarla">
        </a>
        が大体<time datetime="2006-01-02">{{ .Date.Format "2006年1月2日" }}ぐらいに投稿</time></p>

      <p class="comment"><a href="https://scrapbox.io/kalaclista/{{ .Title }}">Scrapbox でコメントや意見を書く</a></p>
    </article>
    {{ end }}

    {{ if .Page.IsHome }}
      {{ $pager := .Paginate .Site.RegularPages.ByDate.Reverse }}
      {{ $pages := $pager.Pages }}

      {{ $count := 0 }}
      {{ $displayed := 0 }}

      <main id="echos">
        {{ range $idx, $page := $pages }}
          {{ block "echo" $page }}
          {{ end }}

          {{ if and (ne $count 0) (lt $displayed 2) (eq (mod $count 5) 0) }}
            {{ partial "shared/adsense.html.html" $.Site.Params.adsense.top }}
            {{ $displayed = add $displayed 1 }}
          {{ end }}

          {{ $count = add $count 1 }}
        {{ end }}
        
        <nav class="pagination">
          {{ if $pager.HasPrev }}
          <a href="{{ absURL (printf "/echos/pages/%d/" $pager.Prev.PageNumber) }}">前</a>
          {{ end }}

          {{ if $pager.HasNext }}
          <a href="{{ absURL (printf "/echos/pages/%d/"  $pager.Next.PageNumber) }}">次</a>
          {{ end }}
        </nav>
      </main>
    {{ else }}
      {{ $pages := slice }} 

      {{ $date := partial "functions/parsedate.html.html" .Page | unmarshal }}

      {{ if (and (default false $date.hasDay) (default false $date.hasMonth)) }}
        {{ $pages = where .Site.RegularPages.ByDate.Reverse "Date.Day" "==" (int $date.day) }}
        {{ $pages = where $pages "Date.Month" "==" (int $date.month) }}
        {{ $pages = where $pages "Date.Year" "==" (int $date.year) }}
      {{ else if (default false $date.hasMonth) }}
        {{ $pages = where .Site.RegularPages.ByDate.Reverse "Date.Month" "==" (int $date.month) }}
        {{ $pages = where $pages "Date.Year" "==" (int $date.year) }}
      {{ else }}
        {{ $pages = where .Site.RegularPages.ByDate.Reverse "Date.Year" "==" (int $date.year) }}
      {{ end }}

      {{ $count := 0 }}
      {{ $displayed := 0 }}
      <main id="echos">
        {{ range $page := $pages }}
          {{ block "echo" . }}
          {{ end }}
  
          {{ if and (ne $count 0) (lt $displayed 2) (eq (mod $count 7) 0) }}
            {{ partial "shared/adsense.html.html" $.Site.Params.adsense.top }}
            {{ $displayed = add $displayed 1 }}
          {{ end }}

          {{ $count = add $count 1 }}
        {{ end }} 
        </main>
      {{ end }}


    {{ partial "shared/adsense.html.html" .Site.Params.adsense.bottom }}
    {{ partial "shared/footer.html.html" . }}
  </body>
</html>
